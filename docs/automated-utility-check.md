# ユーティリティクラスの自動検証チェック

## 1. 目的

このドキュメントは、`yarn check:utilities` コマンドの目的、仕組み、および実装について説明します。

このコマンドの主な目的は、コアパッケージ (`smsshcss`) で定義・生成されるべき全てのデフォルトユーティリティクラスが、Viteプラグイン (`@smsshcss/vite`) を通して正しく利用可能であることを自動的に検証することです。

これにより、以下の点を保証します。

- **リグレッションの防止:** コアロジックや設定の変更が、プラグインの挙動に意図しない影響を与えていないかを確認します。
- **一貫性の担保:** コアとプラグイン間の機能的な一貫性を保ち、信頼性を高めます。
- **開発効率の向上:** 手動での動作確認の手間を省き、開発者が安心して変更を行える環境を維持します。

## 2. 仕組みの概要

`yarn check:utilities` コマンドは、以下のステップで検証を実行するNode.jsスクリプト (`scripts/check-utilities.ts`) です。

1.  **期待されるクラスリストの生成:**

    - `smsshcss` パッケージの `defaultConfig` を直接インポートし、そこから全てのデフォルトユーティリティクラス名（例: `p-sm4`, `bg-blue-500`, `w-full`）のリストを動的に生成します。

2.  **CSSの自動生成:**

    - `playground/vite-plugin` ディレクトリをテストベッドとして利用します。
    - ステップ1で生成した全てのクラス名を含む一時的なHTMLファイル (`check-utilities.html`) を作成します。
    - Viteのビルドプロセスを実行すると、ViteプラグインがこのHTMLファイルを読み込み、HTML内に存在するクラスに対応するCSSを生成します。

3.  **結果の検証:**

    - ビルドによって出力されたCSSファイル（例: `dist/assets/main-xxxx.css`）の内容を読み取ります。
    - ステップ1で生成した「期待されるクラスリスト」と、実際に生成されたCSSの内容を照合します。
    - リスト内の各クラスについて、対応するCSSルールがファイル内に存在するかをチェックします。

4.  **結果の報告:**

    - 全てのクラスがCSS内に存在すれば、成功メッセージを表示して終了します。
    - 一つでも不足しているクラスが見つかった場合は、どのクラスが不足しているかをリストアップしてエラー報告し、CI/CDプロセスで失敗を検知できるよう終了コード `1` でプロセスを終了します。

5.  **クリーンアップ:**
    - 検証の最後に、作成した一時的なHTMLファイルを自動的に削除します。

## 3. セットアップと構成

この仕組みを実現するために、以下のファイルがプロジェクトに追加・設定されています。

- **`scripts/check-utilities.ts`**:

  - 検証ロジックの本体が記述されたTypeScriptファイルです。

- **`scripts/tsconfig.json`**:

  - 上記のスクリプトを `ts-node` で正しく実行するための専用TypeScript設定ファイルです。Node.js環境の型定義を読み込み、`smsshcss` パッケージのソースコードをインポートできるように設定されています。

- **`package.json`**:
  - `scripts` オブジェクトに、コマンドを実行するためのエントリーポイントが追加されています。
    ```json
    "scripts": {
      "check:utilities": "ts-node --project scripts/tsconfig.json scripts/check-utilities.ts"
    }
    ```
  - 開発依存関係 (`devDependencies`) に `ts-node` と `@types/node` が追加されています。

## 4. 将来の拡張性

この検証スクリプトは、将来的にVite以外のプラグイン（例: PostCSSプラグイン）が開発された際にも再利用・拡張できるように設計されています。

スクリプトに `--plugin=postcss` のような引数を渡せるように修正を加えることで、テスト対象のプレイグラウンドやビルドコマンドを切り替え、同じ検証ロジックを異なるプラグインに対して適用することが可能です。
